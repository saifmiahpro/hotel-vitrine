# Netlify Configuration File
# Documentation: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
  publish = "dist"
  command = "npm run build"

# Security Headers
# These headers provide strong security defaults for the hotel website

# Special headers for Decap CMS admin interface
# Note: /admin* matches /admin, /admin/, and /admin/anything
[[headers]]
  for = "/admin*"
  [headers.values]
    # HSTS - Force HTTPS
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"

    # Content Security Policy for Decap CMS - allows required external scripts
    Content-Security-Policy = """
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://identity.netlify.com;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://unpkg.com;
      font-src 'self' data: https://fonts.gstatic.com;
      img-src 'self' data: https: blob:;
      frame-src https://www.google.com https://hotel-anatole-france.netlify.app;
      connect-src 'self' https://api.netlify.com https://hotel-anatole-france.netlify.app https://github.com;
      worker-src 'self' blob:;
    """

    # Other security headers
    Referrer-Policy = "strict-origin-when-cross-origin"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "SAMEORIGIN"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Headers for public pages
[[headers]]
  for = "/*"
  [headers.values]
    # HSTS - Force HTTPS for 2 years (including subdomains)
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"

    # Content Security Policy
    # Note: Temporarily relaxed to allow Decap CMS to work
    # TODO: Tighten this after confirming CMS works
    Content-Security-Policy = """
      default-src 'self';
      img-src 'self' data: https:;
      script-src 'self' 'unsafe-inline' 'unsafe-eval' https://identity.netlify.com https://unpkg.com;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://unpkg.com;
      font-src 'self' data: https://fonts.gstatic.com;
      frame-src https://www.google.com https://hotel-anatole-france.netlify.app;
      connect-src 'self' https://api.netlify.com https://hotel-anatole-france.netlify.app https://github.com https://identity.netlify.com;
      worker-src 'self' blob:;
      upgrade-insecure-requests;
    """

    # Referrer Policy - Only send origin when cross-origin
    Referrer-Policy = "strict-origin-when-cross-origin"

    # Prevent MIME type sniffing
    X-Content-Type-Options = "nosniff"

    # Prevent clickjacking (allow same origin)
    X-Frame-Options = "SAMEORIGIN"

    # Permissions Policy - Disable unnecessary browser features
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Cache optimization for static assets
[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.woff2"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Redirect rules (optional - uncomment if needed)
# [[redirects]]
#   from = "/old-page"
#   to = "/new-page"
#   status = 301

# Form submission handling (Netlify Forms)
# The contact form uses Netlify Forms by default
# Submissions will appear in your Netlify dashboard
